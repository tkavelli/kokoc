# Проект Kokoc

## Описание

Проект Kokoc направлен на разработку рекомендательной системы для повышения вовлеченности пользователей и конверсии на платформе электронной коммерции. Мы используем ансамбль машинных моделей, включая нейронные сети на основе трансформеров, модели градиентного бустинга и графовую сеть внимания (GAT).

Основные функции проекта включают:
- Подготовка данных: обработка исходных данных, генерация признаков и работа с эмбеддингами продуктов.
- Балансировка классов с помощью SMOTE для решения проблемы дисбаланса классов.
- Обучение различных моделей (градиентный бустинг, трансформеры, GAT) и их ансамблирование для повышения качества рекомендаций.
- Тонкая настройка гиперпараметров моделей с использованием Optuna.

## Структура проекта
```
kokoc/
│
├── configs/                   # Конфигурационные файлы проекта
│   ├── inuse/                 # Оптимизированные конфигурации, используемые в последних запусках
│   ├── backups/               # Резервные копии конфигурационных файлов
│   ├── config.yml             # Главный конфигурационный файл, объединяющий остальные
│   ├── data_paths.yml         # Конфигурация путей к данным (сырые, промежуточные, обработанные данные)
│   ├── preprocessing.yml      # Настройки для предварительной обработки данных
│   ├── split.yml              # Настройки для разделения данных на обучающую и тестовую выборки
│   ├── smote.yml              # Настройки для применения SMOTE для балансировки классов
│   ├── training.yml           # Конфигурация гиперпараметров для обучения
│   ├── models.yml             # Конфигурация для всех моделей, используемых в обучении
│   ├── ensemble.yml           # Конфигурация для ансамбля моделей и их весов
│   ├── logging.yml            # Конфигурация логирования
│   ├── output.yml             # Пути для сохранения результатов и визуализаций
│   └── model_cache.yml        # Конфигурация для кэширования моделей
│
├── data/                      # Данные проекта
│   ├── raw/                   # Сырые данные
│   │   ├── stokman_catalog_preprocessed.pq  # Каталог товаров без текстовых названий
│   │   ├── train_actions.pq   # Действия пользователей с продуктами (клики, покупки и т.д.)
│   │   ├── vectors.npz        # Эмбеддинги слов, используемые для генерации эмбеддингов товаров
│   │   └── catalog_vector_mapping.pq # Соответствие между ID товаров и эмбеддингами
│   ├── processed/             # Полностью обработанные данные для обучения и тестирования
│   │   ├── train_data_resampled.parquet  # Данные для обучения после применения SMOTE
│   │   ├── train_data_nn.parquet  # Данные для обучения нейронных сетей (без SMOTE)
│   │   └── test_data.parquet  # Данные для тестирования моделей
│   └── interim/               # Промежуточные данные, используемые в процессе обработки
│       ├── scaler.pkl         # Сохраненный StandardScaler после обучения
│       ├── imputer.pkl        # Сохраненный Imputer для заполнения пропусков
│       └── encoders/          # Энкодеры, используемые для категориальных признаков
│           ├── user_encoder.pkl  # LabelEncoder для пользователей
│           └── product_encoder.pkl  # LabelEncoder для товаров
│
├── models/                    # Сохраненные модели и энкодеры
│   ├── encoders/              # Дополнительные энкодеры для категориальных признаков
│   ├── cache/                 # Кэшированные модели для возможного повторного использования
│   ├── lightgbm_model.txt     # Сохраненная модель LightGBM
│   ├── catboost_model.cbm     # Сохраненная модель CatBoost
│   ├── xgboost_model.json     # Сохраненная модель XGBoost
│   ├── transformer_model.ckpt # Сохраненная модель трансформера
│   ├── gat_model.ckpt         # Сохраненная модель GAT
│
├── outputs/                   # Результаты работы моделей и графики
│   ├── plots/                 # Графические визуализации
│   │   ├── class_distribution_before_smote.png  # Распределение классов до SMOTE
│   │   ├── class_distribution_before_smote.html # HTML график до SMOTE
│   │   ├── class_distribution_after_smote.png   # Распределение классов после SMOTE
│   │   ├── class_distribution_after_smote.html  # HTML график после SMOTE
│   │   ├── feature_importance_lgbm.html         # Важность признаков для LightGBM
│   │   ├── feature_importance_catboost.html     # Важность признаков для CatBoost
│   │   └── feature_importance_xgboost.html      # Важность признаков для XGBoost
│   └── predictions/           # Прогнозы моделей
│       └── ensemble_predictions.csv  # Прогнозы ансамбля моделей
│
├── scripts/                   # Скрипты для выполнения различных этапов проекта
│   ├── config_loader.py       # Загрузка и сохранение конфигурационных файлов
│   ├── data_preparation.py    # Подготовка данных и генерация признаков
│   ├── ensemble_model.py      # Логика создания ансамбля моделей
│   ├── gradient_boosting_models.py  # Скрипт для обучения моделей градиентного бустинга
│   ├── graph_model.py         # Скрипт для определения GAT модели
│   ├── hyperparameter_optimization.py  # Оптимизация гиперпараметров с использованием Optuna
│   ├── main.py                # Основной скрипт для запуска полного пайплайна
│   ├── neural_network_model.py  # Скрипт для модели на основе трансформеров
│   ├── train_graph_model.py   # Обучение GAT модели
│   ├── train_neural_network.py  # Обучение трансформерной модели
│   └── utils.py               # Вспомогательные функции, используемые в скриптах
│
├── tests/                     # Модульные тесты для проверки корректности кода
│   ├── test_data_preparation.py
│   ├── test_gradient_boosting_models.py
│   ├── test_neural_network_model.py
│   ├── test_graph_model.py
│   ├── test_ensemble_model.py
│   └── test_utils.py
│
├── notebooks/                 # Jupyter ноутбуки для анализа данных и экспериментов
│   ├── exploratory_data_analysis.ipynb  # Ноутбук для анализа данных
│   ├── model_comparison.ipynb  # Сравнение производительности моделей
│   └── feature_engineering.ipynb  # Эксперименты с новыми признаками
│
├── logs/                      # Логи различных скриптов и обучения моделей
│   ├── data_preparation.log
│   ├── gradient_boosting_models.log
│   ├── neural_network_model.log
│   ├── graph_model.log
│   └── ensemble_model.log
│
├── venv/                      # Виртуальное окружение Python для зависимостей проекта
│
├── requirements.txt           # Зависимости проекта
├── README.md                  # Описание проекта и инструкции
└── .gitignore                 # Файл для исключения файлов из репозитория
```

## Основные моменты
- **Ансамбль моделей**: включает трансформеры, модели градиентного бустинга (LightGBM, CatBoost, XGBoost) и графовую сеть внимания (GAT).
- **Балансировка классов**: Использование SMOTE для борьбы с дисбалансом классов.
- **Настройка гиперпараметров**: Использование Optuna для оптимизации параметров моделей.
- **Генерация эмбеддингов**: Работа с эмбеддингами для продуктов, включая обработку отсутствующих текстовых данных.

## Текущий статус
На данный момент реализованы основные этапы подготовки данных, балансировка классов и начальная версия моделей. Далее требуется доработка тренировочных скриптов и проверка корректного сохранения графиков и логов в соответствии с новой файловой структурой.